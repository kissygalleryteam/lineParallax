/*! lineParallax - v0.5 - 2013-09-23 10:16:56 AM
* Copyright (c) 2013 mingzheng; Licensed  */
KISSY.add("gallery/lineParallax/0.5/anim-helper",function(a,b,c,d){function e(a){var b=this;e.superclass.constructor.call(b,a)}c.all;var f={},g=0,h=null;return a.extend(e,b,{add:function(b,c){var d=a.clone(c);a.mix(d,this.get("defaultCfg"),!1),"undefined"==typeof d.startTime&&(d.startTime=a.now()),"undefined"==typeof f[b]&&g++,f[b]=d,this.run()},run:function(){null===h&&(h=setInterval(a.bind(this._frame,this),this.get("interval")))},stop:function(){null!==h&&clearInterval(h),h=null},_frame:function(){var b=this;a.each(f,function(a,c){b._handleAnimItem(c,a)})},_handleAnimItem:function(b,c){var e,h=d.Easing[c.easing]||d.Easing.easeNone,i=c.startTime,j=c.handle,k=c.complete,l=parseFloat(c.end),m=parseFloat(c.start),n=c.duration,o=a.now();o>=i+n?(j(l),k&&k(),delete f[b],g--,0==g&&this.stop()):(e=o-i,j(m+parseFloat(((l-m)*h(e/n)).toFixed(3))))}},{ATTRS:{defaultCfg:{value:{duration:1e3,easing:"linear"}},interval:{value:15}}}),e},{requires:["base","node","anim"]}),KISSY.add("gallery/lineParallax/0.5/index",function(a,c,d,e,f){function h(a){var c,d=a.slice(1);return c=d.length,3==c&&(d=d[0]+d[0]+d[1]+d[1]+d[2]+d[2]),r=parseInt(d.slice(0,2),16),g=parseInt(d.slice(2,4),16),b=parseInt(d.slice(4,6),16),[r,g,b]}function i(b){var c,d="#";return a.each(b,function(a){c=a.toString(16),1==c.length&&(c="0"+c),d+=c}),a.log(d),d}function j(b,c,d){var e,f=h(b),g=h(c),j=[];return a.each(f,function(a,b){e=g[b],j.push(Math.floor(a+(e-a)*(d/100)))}),i(j)}function k(a,b,c){return a+(b-a)*(c/100)}function l(a,b,c){var d,e=parseInt(a),f=parseInt(b);return d=e+(f-e)*(c/100),d+"px"}function m(a){var b=this;m.superclass.constructor.call(b,a)}d.all;var n=new f,o=0,p={linear:function(a){return a}},q={length:l,color:j,number:k},s={top:"length",right:"length",bottom:"length",left:"length",marginLeft:"length",marginRight:"length",marginTop:"length",marginBottom:"length",color:"color",backgroundColor:"color",opacity:"number",width:"length",height:"length",backgroundPositionX:"length",backgroundPositionY:"length"};return a.extend(m,c,{add:function(a){var b=this.get("actionList");b.push(a),this._regionsPreprocess(a.regions),this._initAction(a)},addHook:function(a,b){var c=this.get("hookList");c.push({triggers:a,handle:b})},move:function(a){var b=this.get("index");a!==b&&(o=b,this.set("index",a),this._handleActions(),this._handleHooks())},anim:function(b,c){var d=a.mix(c||{},this.get("animCfg"),!1);d.start=this.getIndex(),d.end=b,d.handle=a.bind(this.move,this),n.add("move",d)},stop:function(){n.stop()},getIndex:function(){return this.get("index")},_initAction:function(b){var c,e=d.all(b.dom),f=b.regions;return b.dom=e,f&&0!=f.length?(c=f[0],e.css(c.startCss),void 0):(a.log("regions \u4e0d\u5b58\u5728\u6216\u8005\u4e3a\u7a7a"),void 0)},_handleActions:function(){var b=this.get("actionList"),c=this;a.each(b,function(a){c._handleAction(a)})},_handleAction:function(b){var c,d,e,f,g,h,i,j,k,l,m,n,r=b.dom,t={},u=this.get("index"),v=(this.get("length"),b.regions),w=u-o,x=v.length;a.each(v,function(a,b){return c=a.start,d=a.end,g=u-c,h=d-u,0>=g?0==b||0>w?(i=0,m=b,!1):(i=100,m=b-1,!1):0>=h?b==x-1?(i=100,m=b,!1):void 0:(m=b,i=100*(g/(d-c)),!1)}),j=p.linear(i),n=v[m],e=n.startCss,f=n.endCss,a.each(e,function(a,b){k=f[b],l=q[s[b]](a,k,j),t[b]=l}),r.css(t)},_regionsPreprocess:function(b){var c,d,e,f={},g=[],h=[];a.each(b,function(i,j){e=j-1,c=i.startCss,d=i.endCss,a.each(f,function(a,b){"undefined"!=typeof c[b]||g.push(b)}),a.each(d,function(a,b){"undefined"!=typeof f[b]||h.push(b),f[b]=a}),a.each(h,function(a){for(;e>-1;)b[e].endCss[a]=b[e].startCss[a]=c[a],e--}),a.each(g,function(a){d[a]=c[a]=f[a]}),g.length=0,h.length=0})},_handleHooks:function(){var b=this.get("hookList"),c=this;a.each(b,function(a){c._handlehook(a)})},_handlehook:function(b){var c,d=o,e=this.get("index"),f=b.triggers,g=b.handle,h=e-d>0?1:-1;c=this._getEffectedTriggers(d,e,f),a.each(c,function(a){g(a,h,d,e)})},_getEffectedTriggers:function(a,b,c){var d,e,f,g,h,i=c.length,j=[],k=b-a>0?1:-1;for(f=0,g=i-1,d=e=-1;g>=f;f++)h=c[f],b-h>=0&&e++,a-h>=0&&d++;var l=Math.min(d,e),m=Math.max(d,e);for(l++;m>=l;l++)j.push(c[l]);return 0>k&&j.reverse(),j}},{ATTRS:{length:{value:1e3},index:{value:0},animConfig:{value:null},actionList:{value:[]},hookList:{value:[]},animCfg:{value:{duration:1e3,easing:"linear"}}}}),m},{requires:["base","node","anim","./anim-helper"]});